---
title: "Syndromicity analysis"
output: html_notebook
---

Analysis for syndromicity based on several factors:
- whether a disease contains 'syndrome' in the name?
- the amount of genes associated to different branches?

As of 30 July, there is no clear correlation between the 'syndromicity' and the number of tissues either way

```{r}
library(tidyverse)

disease_dat <- read_tsv("./data/orphaNet_disease_gene_association_with_roots.tsv")

disease_dat_symdrome <- disease_dat %>% 
  mutate(syndromic = grepl("syndrome", label)) %>% rowwise() %>%
  mutate(genes_unique = str_split(genes, ";"),
         root_unique = str_split(roots, ";")) %>% 
  dplyr::filter(!is.na(roots)) %>% 
  select(-orphaID, -description, - genes, -roots) %>%
  unnest(., col = root_unique) %>%
  unnest(., col = genes_unique)


####
# this is the proportion of unique genes involved in an orphaID with 'syndrome' in its name
disease_dat_gene <- disease_dat_symdrome %>% group_by(root_unique, genes_unique) %>%
  summarise(anySyndrome = any(syndromic)) %>%
  group_by(root_unique) %>% summarise(n_genes = n(), n_syndromic = sum(anySyndrome))  %>%
  mutate(prop_syndrome = n_syndromic/n_genes)


###
## mapping of syndromicity without gene indication
disease_dat_syndromic_without_gene <- disease_dat_symdrome %>% 
  distinct(label, root_unique, .keep_all = T) %>%
  count(root_unique, syndromic) %>%
  group_by(root_unique) %>% mutate(n_terms = sum(n), prop_syndrome = n/n_terms) %>% dplyr::filter(syndromic) 
```


```{r}
disease_dat_syndromic_without_gene$root_unique = factor(disease_dat_syndromic_without_gene$root_unique, levels = levels(AUC_folds_summary$name))


ggplot(disease_dat_syndromic_without_gene %>% dplyr::filter(!is.na(root_unique))) + geom_tile(aes(x = 1, y = root_unique, fill = cut(prop_syndrome, breaks = c(0, 0.25, 0.5, 0.75, 1), include.lowest = T))) + scale_fill_brewer()#+ theme(axis.text.y = NULL)
```


```{r}
disease_dat_gene$root_unique = factor(disease_dat_gene$root_unique, levels = levels(AUC_folds_summary$name))


ggplot(disease_dat_gene %>% dplyr::filter(!is.na(root_unique))) + geom_tile(aes(x = 1, y = root_unique, fill = cut(prop_syndrome, breaks = c(0, 0.25, 0.5, 0.75, 1), include.lowest = T))) + scale_fill_brewer()#+ theme(axis.text.y = NULL)
```

```{r}
ggplot(disease_dat_gene %>% dplyr::filter(!is.na(root_unique))) + geom_tile(aes(x = 1, y = root_unique, fill = cut(prop_syndrome, breaks = c(0, 0.4, 1), include.lowest = T))) + scale_fill_brewer()#+ theme(axis.text.y = NULL)
```


```{r}
ggplot(disease_dat_gene %>% dplyr::filter(!is.na(root_unique))) + geom_tile(aes(x = 1, y = root_unique, fill = prop_syndrome)) + geom_text(aes(x = 1, y = root_unique, label = round(prop_syndrome,2))) + scale_fill_distiller(direction = 1)#+
```

# Define syndromicity unrelated to syndrome in name
```{r}
disease_dat_symdrome <- disease_dat %>% 
  rowwise() %>%
  mutate(nroots = str_count(roots,";") +1, 
         syndromic = grepl("syndrome", label),
         syndromic_by_root = nroots >= 5
    ) %>% 
  mutate(genes_unique = str_split(genes, ";"),
         root_unique = str_split(roots, ";")) %>% 
  dplyr::filter(!is.na(roots)) %>% 
  select(-orphaID, -description, - genes, -roots) %>%
  unnest(., col = root_unique) %>%
  unnest(., col = genes_unique)


####
# this is the proportion of unique genes involved in an orphaID with 'syndrome' in its name
disease_dat_gene <- disease_dat_symdrome %>% group_by(root_unique, genes_unique) %>%
  summarise(anySyndrome = any(syndromic_by_root)) %>%
  group_by(root_unique) %>% summarise(n_genes = n(), n_syndromic = sum(anySyndrome))  %>%
  mutate(prop_syndrome = n_syndromic/n_genes)


###
## mapping of syndromicity without gene indication
disease_dat_syndromic_without_gene <- disease_dat_symdrome %>% 
  distinct(label, root_unique, .keep_all = T) %>%
  count(root_unique, syndromic) %>%
  group_by(root_unique) %>% mutate(n_terms = sum(n), prop_syndrome = n/n_terms) %>% dplyr::filter(syndromic) 
```


```{r}
disease_dat_gene$root_unique = factor(disease_dat_gene$root_unique, levels = levels(AUC_folds_summary$name))

ggplot(disease_dat_gene %>% dplyr::filter(!is.na(root_unique))) + geom_tile(aes(x = 1, y = root_unique, fill = prop_syndrome)) + geom_text(aes(x = 1, y = root_unique, label = round(prop_syndrome,2))) + scale_fill_distiller(direction = 1)#+
```

