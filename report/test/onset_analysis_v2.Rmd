---
title: "Onset_analysis_v2"
author: "Ize Buphamalai"
date: "1/28/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r load the data}
library(ggpubr) # for plots with p values

source("../functions/readdata_functions.R")
source("../functions/process_LCC_result.R")

library(igraph)


# onset data
#######

# load individual gene disease association
orphaID_to_name_df <- read_csv("../data/orphanumbers_to_name.csv", col_names = c("orphaID", "orphaName"))
orphaID_to_name_df$orphaID <- paste0("Orphanet:", orphaID_to_name_df$orphaID)

disease_gene_root_df <- read_tsv("../data/orphaNet_disease_gene_association_with_roots.tsv", col_types = "ccc--c")


# load onset to disease label 
onsets <- list.files("../data/orphanet_onset/")
onset_df <- lapply(onsets, function(x) read_lines(sprintf("../data/orphanet_onset/%s", x))); names(onset_df) <- onsets
onset_df <- melt(onset_df); names(onset_df) <- c("label", "onset")


# join the two tables above
disease_gene_root_onset_df <- left_join(disease_gene_root_df, onset_df)

# make unique rows for each roots and each gene
disease_gene_root_onset_df <- disease_gene_root_onset_df %>% separate_rows(roots, sep = ";") %>% separate_rows(genes, sep = ";")


##########

# load graph
g = process_graph_data("../data/network_edgelists/")

#### load the coexpression network combn and extract core transcriptional module
coex_count_el = readRDS("./cache/coexpression_raw_edge_counts.RDS")

## core transcriptional modules: the number of tissues are over five
g[["coex_coremodule"]] = graph_from_data_frame(coex_count_el[coex_count_el$n >= 5,c("A","B")], directed = F)
```


## Quality of annotation, distribution of onset

```{r}
disease_gene_root_onset_df %>% distinct(label, onset) %>% count(onset) 
```

There are over 3000 diseases without onset label. Any analysis based on this will be relatively underrepresented

```{r}
disease_gene_root_onset_df %>% distinct(genes, onset) %>% count(onset) 
```
Among documented genes, infancy is most prevalent

Next, check whether genes are prevalent with any spectrum